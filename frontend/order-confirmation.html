<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - NETH Bookhive</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/student.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <section class="confirmation-section" style="padding: 120px 20px 80px; min-height: 100vh; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
        <div class="container" style="max-width: 800px; margin: 0 auto;">
            <div class="confirmation-card" style="background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;">
                <div class="success-icon" style="width: 100px; height: 100px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; animation: scaleIn 0.5s;">
                    <i class="fas fa-check" style="font-size: 3em; color: white;"></i>
                </div>

                <h1 style="font-size: 2.5em; color: #2c3e50; margin-bottom: 1rem;">Order Confirmed!</h1>
                <p style="font-size: 1.2em; color: #7f8c8d; margin-bottom: 2rem;">Thank you for your order. We'll send you a confirmation email shortly.</p>

                <div id="orderDetails" style="background: #f8f9fa; padding: 2rem; border-radius: 15px; margin: 2rem 0; text-align: left;">
                    <h2 style="color: #667eea; margin-bottom: 1.5rem; text-align: center;">Order Details</h2>
                    <div id="orderInfo">
                        <p><i class="fas fa-spinner fa-spin"></i> Loading order details...</p>
                    </div>
                </div>

                <div class="action-buttons" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="index.html" style="padding: 1rem 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; font-weight: 600;">
                        <i class="fas fa-home"></i> Back to Home
                    </a>
                    <a href="shop.html" style="padding: 1rem 2rem; background: white; color: #667eea; border: 2px solid #667eea; text-decoration: none; border-radius: 10px; font-weight: 600;">
                        <i class="fas fa-shopping-bag"></i> Continue Shopping
                    </a>
                </div>
            </div>
        </div>
    </section>

    <style>
        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .order-info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .order-info-row:last-child {
            border-bottom: none;
        }

        .order-info-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .order-info-value {
            color: #7f8c8d;
        }

        .order-items-list {
            margin-top: 1.5rem;
        }

        .order-item-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: #2c3e50;
        }
    </style>

    <script src="js/accessibility.js"></script>
    <script>
        // Get order number from URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderNumber = urlParams.get('order');

        if (!orderNumber) {
            document.getElementById('orderInfo').innerHTML = '<p style="color: #e74c3c;">No order number provided.</p>';
        } else {
            loadOrderDetails(orderNumber);
        }

        async function loadOrderDetails(orderNumber) {
            try {
                const response = await fetch(`../backend/api/orders.php?action=details&order_number=${orderNumber}`);
                const order = await response.json();

                if (order && order.id) {
                    displayOrderDetails(order);
                } else {
                    throw new Error('Order not found');
                }
            } catch (error) {
                console.error('Error loading order:', error);
                document.getElementById('orderInfo').innerHTML = '<p style="color: #e74c3c;">Unable to load order details. Please check your email for confirmation.</p>';
            }
        }

        function displayOrderDetails(order) {
            const orderInfoDiv = document.getElementById('orderInfo');
            
            let itemsHTML = '';
            if (order.items && order.items.length > 0) {
                itemsHTML = '<div class="order-items-list"><h3 style="color: #2c3e50; margin-bottom: 1rem;">Order Items</h3>';
                order.items.forEach(item => {
                    itemsHTML += `
                        <div class="order-item-row">
                            <span>${item.title} (x${item.quantity})</span>
                            <span>Rs ${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `;
                });
                itemsHTML += '</div>';
            }

            orderInfoDiv.innerHTML = `
                <div class="order-info-row">
                    <span class="order-info-label">Order Number:</span>
                    <span class="order-info-value">${order.order_number}</span>
                </div>
                <div class="order-info-row">
                    <span class="order-info-label">Order Date:</span>
                    <span class="order-info-value">${new Date(order.created_at).toLocaleDateString()}</span>
                </div>
                <div class="order-info-row">
                    <span class="order-info-label">Status:</span>
                    <span class="order-info-value" style="color: #f39c12; font-weight: 600;">${order.status.toUpperCase()}</span>
                </div>
                <div class="order-info-row">
                    <span class="order-info-label">Payment Status:</span>
                    <span class="order-info-value" style="color: #27ae60; font-weight: 600;">${order.payment_status.toUpperCase()}</span>
                </div>
                ${itemsHTML}
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #e0e0e0;">
                    <div class="order-info-row">
                        <span class="order-info-label">Subtotal:</span>
                        <span class="order-info-value">Rs ${parseFloat(order.subtotal).toFixed(2)}</span>
                    </div>
                    <div class="order-info-row">
                        <span class="order-info-label">Shipping:</span>
                        <span class="order-info-value">Rs ${parseFloat(order.shipping_cost).toFixed(2)}</span>
                    </div>
                    <div class="order-info-row">
                        <span class="order-info-label">Tax:</span>
                        <span class="order-info-value">Rs ${parseFloat(order.tax).toFixed(2)}</span>
                    </div>
                    <div class="order-info-row" style="font-size: 1.2em; font-weight: bold; color: #667eea;">
                        <span class="order-info-label">Total:</span>
                        <span class="order-info-value">Rs ${parseFloat(order.total_amount).toFixed(2)}</span>
                    </div>
                </div>
                <div style="margin-top: 1.5rem; padding: 1rem; background: #e8f5e9; border-radius: 10px;">
                    <h3 style="color: #2e7d32; margin-bottom: 0.5rem;"><i class="fas fa-shipping-fast"></i> Shipping Address</h3>
                    <p style="margin: 0; color: #2c3e50;">
                        ${order.full_name}<br>
                        ${order.address_line1}<br>
                        ${order.address_line2 ? order.address_line2 + '<br>' : ''}
                        ${order.city}, ${order.state} ${order.postal_code}<br>
                        ${order.country}<br>
                        Phone: ${order.phone}
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>
